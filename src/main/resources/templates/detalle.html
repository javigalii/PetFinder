<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${animal.nombre} + ' - Detalles'">Detalles</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-orange: #ff5400;
            --dark-bg: #1a1d29;
            --card-bg: #23263a;
            --light-gray: #f5f6f7;
            --hover-orange: #ff6d1f;
            --text-gray: #9ca3af;
            --border-color: #2d3142;
        }

        body {
            background: linear-gradient(180deg, #13151f 0%, #1a1d29 100%);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: #e5e7eb;
            min-height: 100vh;
        }

        /* NAVBAR */
        .navbar-dark-custom {
            background: #13151f;
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
        }
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-orange) !important;
        }
        .nav-link { color: var(--text-gray) !important; font-weight: 500; transition: 0.2s; }
        .nav-link:hover { color: white !important; }

        /* BREADCRUMB */
        .breadcrumb-item a { color: var(--text-gray); text-decoration: none; }
        .breadcrumb-item.active { color: white; }

        /* IMAGEN PRINCIPAL */
        .main-image-container {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
            height: 500px;
        }
        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .image-overlay-badge {
            position: absolute;
            top: 20px; left: 20px;
            background: var(--primary-orange);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* INFO CARD STICKY */
        .info-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            position: sticky;
            top: 20px;
        }
        .animal-title { color: white; font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        .stat-label { color: var(--text-gray); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { color: white; font-size: 1.2rem; font-weight: 700; }

        /* BADGES */
        .badge-custom { font-size: 0.9rem; padding: 8px 12px; border-radius: 6px; margin-right: 5px; }
        .badge-male { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-female { background: rgba(236, 72, 153, 0.15); color: #f472b6; border: 1px solid rgba(236, 72, 153, 0.3); }
        .badge-neutered { background: rgba(34, 197, 94, 0.15); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.3); }

        /* USER CARD */
        .user-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        .user-avatar {
            width: 50px; height: 50px;
            background: var(--primary-orange);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 1.2rem;
        }

        /* Efecto hover para el enlace del perfil */
        .hover-effect:hover {
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }
        .hover-effect:hover .user-name {
            color: var(--primary-orange) !important;
        }

        /* BUTTONS */
        .btn-like-large {
            background: rgba(255, 84, 0, 0.1);
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            transition: 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        .btn-like-large:hover { background: rgba(255, 84, 0, 0.2); color: white; transform: translateY(-2px); }

        .btn-like-large.active {
            background: var(--primary-orange);
            color: white;
        }

        .btn-contact {
            background: white; color: black;
            font-weight: bold; width: 100%; border: none; padding: 10px; border-radius: 8px;
        }
        .btn-contact:hover { background: #e5e7eb; }

    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark-custom sticky-top">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fa-solid fa-paw"></i> Petfinder
        </a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/">Volver al Cat√°logo</a></li>
                <li class="nav-item"><a class="nav-link" href="/blog">Noticias</a></li>
                <li class="nav-item"><a class="nav-link" href="/perfil">Mi Perfil</a></li>
                <li class="nav-item"><a class="nav-link" href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Salir</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container py-4">

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Cat√°logo</a></li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${animal.nombre}">Nombre</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8">

            <div class="main-image-container mb-4">
                <img th:src="@{'/file/download/' + ${animal.imagenUrl}}"  class="main-image" alt="Foto del animal">
                <span class="image-overlay-badge">
                    <i class="fa-solid fa-tag me-2"></i><span th:text="${animal.tipo}">TIPO</span>
                </span>
            </div>

            <div class="card p-4 mb-4" style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px;">
                <h3 class="text-white mb-3"><i class="fa-solid fa-align-left text-primary me-2"></i>Sobre m√≠</h3>
                <p class="text-secondary" style="line-height: 1.8;">
                    ¬°Hola! Soy <span th:text="${animal.nombre}" class="fw-bold text-white"></span>.
                    Soy un <span th:text="${animal.raza}"></span> de <span th:text="${animal.edad}"></span> a√±os que vive en
                    <span th:text="${animal.localizacion}"></span>.
                    Estoy buscando una familia que me quiera mucho. ¬øMe das una oportunidad?
                </p>
            </div>

            <div class="user-card" th:if="${animal.usuario != null}">
                <h4 class="text-white mb-3">Publicado por</h4>

                <a th:href="@{/perfil/usuario/{id}(id=${animal.usuario.id})}" class="text-decoration-none">
                    <div class="d-flex align-items-center gap-3 p-2 rounded hover-effect" style="transition: background 0.3s;">

                        <img th:if="${animal.usuario.fotoUrl != null && !animal.usuario.fotoUrl.isEmpty()}"
                             th:src="'/file/download/' + ${animal.usuario.fotoUrl}"
                             class="user-avatar"
                             style="object-fit: cover; padding: 0;"
                             alt="Foto">

                        <div th:if="${animal.usuario.fotoUrl == null || animal.usuario.fotoUrl.isEmpty()}"
                             class="user-avatar"
                             th:text="${#strings.substring(animal.usuario.nombrePila, 0, 1)}">
                            U
                        </div>

                        <div>
                            <h5 class="text-white m-0 user-name" th:text="${animal.usuario.nombrePila}">Nombre Usuario</h5>
                            <small class="text-secondary">Ver perfil completo <i class="fa-solid fa-arrow-right ms-1"></i></small>
                        </div>
                    </div>
                </a>
                <div class="mt-4 p-3 rounded" style="background: rgba(255,255,255,0.05);">
                    <p class="text-secondary small m-0 mb-2">
                        <i class="fa-solid fa-circle-info text-warning me-2"></i>
                        Si te interesa adoptar a <span th:text="${animal.nombre}"></span>, contacta directamente con su cuidador.
                    </p>
                    <a th:href="'mailto:' + ${animal.usuario.email}" class="btn btn-contact mt-2">
                        <i class="fa-solid fa-envelope me-2"></i> Enviar Correo
                    </a>
                </div>
            </div>

        </div>

        <div class="col-lg-4">
            <div class="info-card">

                <h1 class="animal-title" th:text="${animal.nombre}">Nombre</h1>
                <p class="text-secondary mb-4">
                    <i class="fa-solid fa-location-dot text-danger me-2"></i>
                    <span th:text="${animal.localizacion}">Ciudad</span>
                </p>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Edad</div>
                        <div class="stat-value" th:text="${animal.edad} + ' a√±os'">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Raza</div>
                        <div class="stat-value" th:text="${animal.raza}" style="font-size: 1rem;">Raza</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Sexo</div>
                        <div class="stat-value" th:text="${animal.sexo}">Sexo</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Tipo</div>
                        <div class="stat-value" th:text="${animal.tipo}">Tipo</div>
                    </div>
                </div>

                <div class="mb-4">
                    <span class="badge-custom badge-male" th:if="${animal.sexo == 'Macho'}">
                        <i class="fa-solid fa-mars"></i> Macho
                    </span>
                    <span class="badge-custom badge-female" th:if="${animal.sexo == 'Hembra'}">
                        <i class="fa-solid fa-venus"></i> Hembra
                    </span>
                    <span class="badge-custom badge-neutered" th:if="${animal.castrado}">
                        <i class="fa-solid fa-check"></i> Castrado
                    </span>
                </div>

                <hr class="border-secondary my-4">

                <a th:href="@{/animales/megusta/{id}(id=${animal.id})}"
                   class="btn-like-large"
                   th:classappend="${animal.likedByCurrentUser} ? 'active' : ''">
                    <i th:class="${animal.likedByCurrentUser} ? 'fa-solid fa-heart me-2' : 'fa-regular fa-heart me-2'"></i>
                    <span th:text="${animal.likedByCurrentUser} ? 'Guardado en Favoritos' : 'A√±adir a Favoritos'"></span>
                </a>

                <div class="mt-3 d-flex gap-2">
                    <button onclick="compartirWhatsApp()" class="btn btn-outline-success w-100 fw-bold">
                        <i class="bi bi-whatsapp"></i> WhatsApp
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    function compartirWhatsApp() {
        const url = window.location.href;
        const nombre = document.querySelector('.animal-title').innerText;
        const text = `¬°Mira a ${nombre} en Petfinder! Est√° buscando hogar üêæ ${url}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>